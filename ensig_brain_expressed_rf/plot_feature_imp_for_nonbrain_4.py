#Goal: to plot the ROC curve with python scikit learn; plots mean with standard deviation

import numpy as np
from igraph import *
import pandas as pd
import sys
import os
os.environ['KMP_DUPLICATE_LIB_OK']='True'

#-----load your ontology onto HiView-------------------------------------------------------------------------
#code for uploading to HiView taken from DDOT package: https://github.com/michaelkyu/ddot/blob/master/examples/Tutorial.ipynb


import networkx as nx

import matplotlib
matplotlib.use("TKAgg")
from matplotlib import pyplot as plt

import seaborn as sns; sns.set()

import pylab

#construct the random forest so that when doing the 5X cross validation, the model is not seeing 20% of the genes, not just rows--------------------
import random
import pickle
#from define_gene_objects_rf_5 import PairOfGenes

from sklearn.metrics import auc
from itertools import combinations
from collections import defaultdict

from sklearn.metrics import roc_curve
from sklearn.metrics import roc_auc_score

feature_list = ['colon_hpa_isoform_exp', 'ovary_hpa_isoform_exp', 'breast_hpa_isoform_exp', 'lung_hpa_isoform_exp', 'salivary gland_hpa_isoform_exp', 'seminal vesicle_hpa_isoform_exp', 
		'lymph node_hpa_isoform_exp', 'placenta_hpa_isoform_exp', 'kidney_hpa_isoform_exp', 'cervix, uterine_hpa_isoform_exp', 'adrenal gland_hpa_isoform_exp', 'thyroid gland_hpa_isoform_exp', 
		'stomach 1_hpa_isoform_exp', 'gallbladder_hpa_isoform_exp', 'duodenum_hpa_isoform_exp', 'fallopian tube_hpa_isoform_exp','endometrium 1_hpa_isoform_exp', 'skin 1_hpa_isoform_exp', 
		'spleen_hpa_isoform_exp', 'gtex_rna_tissue_expression', 'appendix_hpa_isoform_exp', 'heart muscle_hpa_isoform_exp', 'small intestine_hpa_isoform_exp', 'epididymis_hpa_isoform_exp', 'testis_hpa_isoform_exp', 
		'liver_hpa_isoform_exp', 'esophagus_hpa_isoform_exp', 'urinary bladder_hpa_isoform_exp', 'skeletal muscle_hpa_isoform_exp', 'tonsil_hpa_isoform_exp', 'prostate_hpa_isoform_exp', 
		'parathyroid gland_hpa_isoform_exp','adipose tissue_hpa_isoform_exp', 'smooth muscle_hpa_isoform_exp', 'rectum_hpa_isoform_exp', 'bone marrow_hpa_isoform_exp', 'Protein-Protein Interaction', 
		'chr_no_source_feature', 'qPhos_site_number','Phosphosite_hu_no', 'pFAM_domain_number', 'pFAM_domain', 'protein_mass', 'Ensembl_aa_length', 'Ensembl_isoform_no', 
		'trans_count', 'gc_content', 'trans_len', 'gene_length', 'exon_no', 'cds_length']

#brain_features=['HIP_RNA', 'DFC_RNA', 'V1C_RNA', 'AMY_RNA', 'MD_RNA', 'STR_RNA', 'CBC_RNA', 'HIP_Proteomics', 'DFC_Proteomics', 'V1C_Proteomics', 'AMY_Proteomics', 'MD_Proteomics', 'CBC_Proteomics']

#feature_list=feature_list+brain_features

feature_importance_0=[0.013813792709900954, 0.017640919757023733, 0.016882026429153242, 0.015647585455194367, 0.017407107867944204, 0.014427318018954072, 0.015552662379974547, 0.01576246722320803, 0.015403706629555316, 0.015115251479098125, 0.0167158794048125, 0.016922136772311813, 0.016058008412377405, 0.014730279817695716, 0.01857718881331517, 0.013869381855575737, 0.01455943409258252, 0.020355660008331618, 0.01625404965185931, 0.03172264579774484, 0.016317742795284085, 0.018069037373263253, 0.015131729093975439, 0.01930929703591326, 0.020196386098216158, 0.016112924096994205, 0.015266024279075632, 0.01592020833246418, 0.021192266923692957, 0.016830263632099565, 0.014589455828547785, 0.02149199618500559, 0.01567133555708475, 0.016020603479177505, 0.015385909495176677, 0.02648519533408962, 0.05656826425716397, 0.0010780672336834158, 0.02414980070757697, 0.021403857492684315, 0.02095609149433343, 0.02728348505240676, 0.024794633031208563, 0.031988324795298076, 0.018179179265353496, 0.0173608489818189, 0.027395011476785455, 0.025028309678855845, 0.03791991696167152, 0.025053657343088544, 0.01943267411139688]
feature_importance_1=[0.01438203682273812, 0.01787230983146267, 0.019125449156872948, 0.016750137075810443, 0.020005532451323485, 0.014478336706692178, 0.015938417992184734, 0.01745079088636352, 0.016284510340233524, 0.016880647612018067, 0.018125084346551374, 0.01684811040911522, 0.01568784094674221, 0.017391887963399272, 0.01960987493877535, 0.01536899798706443, 0.015141981827989572, 0.019964533498348546, 0.016562265109913214, 0.028228263797272182, 0.016843271276292586, 0.017978827329835627, 0.015632145506786557, 0.019942659125713993, 0.018231881907473067, 0.017162287465378668, 0.016353744944943648, 0.01751642998789801, 0.02039653378684934, 0.017588099147605955, 0.016586672828784527, 0.02318485200407604, 0.016583668689054115, 0.016025888486014443, 0.016753171029683628, 0.027848497569884098, 0.057546557804431374, 0.000829404005571163, 0.02111381086486982, 0.021131047585278707, 0.01280439294705659, 0.027151236926730646, 0.025259980775852686, 0.021505299354439452, 0.016020732688703597, 0.01592356686615615, 0.02520554533850244, 0.023369336080326434, 0.03538668337750877, 0.029692658747024692, 0.020334105850402136]
feature_importance_2=[0.014418860348586533, 0.016753584700808184, 0.019376409325650424, 0.016078232588017036, 0.018971928293669723, 0.015279145532351712, 0.01562254292847863, 0.016946777270403716, 0.015825559932367533, 0.015013129273745977, 0.017869219326723338, 0.01702159905923011, 0.016133317559461395, 0.016098814457544817, 0.01936212568561969, 0.01474993131554036, 0.014446031502187045, 0.018098486956419257, 0.015358523474313754, 0.029580167836662122, 0.01638331559776887, 0.018121025837427935, 0.015991548992167662, 0.019005903893416325, 0.021406762421858162, 0.017839132535680476, 0.015867857955755193, 0.018194091000812564, 0.023415261753020892, 0.01668186697667746, 0.018155182889538844, 0.018608294428185266, 0.01610784184276586, 0.01717727278318036, 0.015758676258668402, 0.022418222329659912, 0.05239807516586023, 0.0009481821200916611, 0.022118763137995868, 0.021525703673078427, 0.016113287222459246, 0.025657004670662488, 0.023590668213856674, 0.023223255417210528, 0.020194507606057163, 0.015848287143534378, 0.026857334410750472, 0.025962212058071296, 0.041816217787655804, 0.02850139296464788, 0.021108463543702282]
feature_importance_3=[0.01419197414150497, 0.017011118184338373, 0.016935312584940302, 0.01755799131234668, 0.01923010283183422, 0.015698553384977613, 0.016788091937625534, 0.01604556254144345, 0.014978912657824098, 0.017414432250518034, 0.017239534614198596, 0.016283947949979193, 0.016620270651749047, 0.015375671270332077, 0.020268058832647592, 0.015230010120229025, 0.014320548583244766, 0.019437340069936918, 0.015910925519194142, 0.028910842626954657, 0.01636097984224502, 0.01762474041491678, 0.015848898942892355, 0.021091990211667997, 0.02035095546641917, 0.017771924814910744, 0.01592705537086518, 0.017008768426624216, 0.02201392665927697, 0.01655275208646204, 0.015556641742502772, 0.019335343263673067, 0.016167918254373328, 0.01543954096737882, 0.015970160249624946, 0.030987174528957072, 0.06497814281342856, 0.0010535058841489404, 0.019531354955556704, 0.02226995863709401, 0.01824270150101899, 0.02398002552248455, 0.024535530487651894, 0.019735929073388093, 0.018670636229498435, 0.015577524885061502, 0.02497517713197499, 0.025034797738852727, 0.035952351550330344, 0.027635938997176555, 0.018368451283723962]
feature_importance_4=[0.015462197894354197, 0.017047354693825286, 0.017170351356967303, 0.019272376827232526, 0.019579511570565554, 0.015993042867900813, 0.01631563716101236, 0.01611912271858518, 0.01572677752095522, 0.016895732569439624, 0.01763818169064454, 0.01826367858552126, 0.01620837465736603, 0.016265530421627903, 0.0177571895037605, 0.014529844592890553, 0.015148796964519463, 0.01949842340970082, 0.016208980858989062, 0.029723161885074817, 0.017107972099815124, 0.017470266480530197, 0.0169853220594428, 0.019994922098408262, 0.018757305854132475, 0.018043284441852797, 0.016150787916229134, 0.01653995577350103, 0.02345711538732624, 0.016844198112561114, 0.018272133599443068, 0.021419927964121965, 0.016297761529118916, 0.015033928529353858, 0.01578479753086957, 0.02584100110820404, 0.056658003595655385, 0.0010022479888856261, 0.018647120263458637, 0.019186372294479514, 0.012570365700741628, 0.02393082938570151, 0.02319792211871633, 0.023023373319538427, 0.012840529449314225, 0.01962021008524645, 0.02662547836619271, 0.024387443729691722, 0.04028476129948118, 0.03410089334604363, 0.019099500821009432]

df=pd.DataFrame({'Features': feature_list, 'feature_importance_0': feature_importance_0, 'feature_importance_1': feature_importance_1, 'feature_importance_2': feature_importance_2, 'feature_importance_3': feature_importance_3, 'feature_importance_4': feature_importance_4})
df['avg']=df.mean(axis=1)
df['sem']=df[['feature_importance_0','feature_importance_1', 'feature_importance_2','feature_importance_3','feature_importance_4']].sem(axis = 1) 
df.sort_values('avg',inplace=True)

print (df)


#plt.rcdefaults()
#fig, ax = plt.subplots()

# Example data

ax = df.plot.barh(x='Features', y='avg', xerr='sem', color='blue')
ax.get_legend().remove()
#ax.barh(y_pos, performance, xerr='sem', align='center')
#ax.set_xlim(0, 0.2)
ax.set_xlabel('Feature Importance (5X Cross-Validation)')
ax.set_title('Random Forest Feature Importance', fontweight='bold')
plt.grid(b=None)

plt.show()
